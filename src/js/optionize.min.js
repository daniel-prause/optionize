!function(e){var t=null,a={searchBox:{enabled:!1,placeholder:"Search"},noEntriesText:"no entries"},i={};function n(t,a){var i=a.selected?"selected":"",n=a.disabled?"disabled":"",o=a.hidden||!1,d=e("<li>",{"data-text":a.innerHTML,"data-value":a.value,"data-disabled":a.disabled,"data-selected":a.selected,"data-hidden":o,"data-no-entries-element":a.noEntriesElement||!1}).addClass(i).addClass(n).addClass("option");a.hidden&&d.css("display","none");var l=a.dataset.afterText||"",s=a.dataset.beforeText||"";d.html(`${s}${a.innerHTML}${l}`),t.append(d)}function o(t,a,o,d){var l="disabled"==t.closest("fieldset").attr("disabled");e.each(o,function(t,i){if(l&&(i.disabled=!0),"OPTGROUP"==i.tagName){var o,d,s,r,c;o=a,s=(d=i).dataset.afterText||"",r=d.dataset.beforeText||"",(c=e("<li>").addClass("optgroup")).html(`${r}${d.label}${s}`),c.attr("data-hidden","false"),o.append(c)}else n(a,i)}),n(a,{innerHTML:i[d].noEntriesText,disabled:!0,selected:!1,hidden:o.length>0,value:"-",dataset:{},noEntriesElement:!0})}function d(e,t){"OPTGROUP"!=t.tagName&&(e.addClass("selected"),e.attr("data-selected","true"),t.selected=!0)}function l(e,t){"OPTGROUP"!=t.tagName&&(e.removeClass("selected"),e.attr("data-selected","false"),t.selected=!1)}function s(t,a){e(a).val().length>0?t.find(".optgroup").attr("data-hidden","true").hide():t.find(".optgroup").attr("data-hidden","false").show();var i=!1;t.find("li").each(function(t,n){(regex=RegExp(e(a).val(),"i")).test(e(n).text())&&"false"==e(n).attr("data-hidden")?(i=!0,e(n).show()):e(n).hide(),i||"true"!=e(n).attr("data-no-entries-element")||e(n).show()})}e.fn.optionize=function(n){return e(this).each(function(r,c){if("multiple"!==e(c).attr("multiple")){console.log("sorry, currently optionize only works on multi select boxes.");return}var p=e(c).attr("id")||e(c).attr("name");if(p||(p=`id-${e("select").index(e(c))}`,e(c).attr("id",p)),!(e(`.optionize-${p}`).length>0)){n&&"object"==typeof n&&(i[p]={},e.extend(!0,i[p],a,n));var h,f,u,b,g=e(c).find("optgroup, option"),v=e("<ul>").addClass(`optionize optionize-${p}`);o(e(c),v,g,p),e(c).hide(),e(c).before(v),function a(i,n){n.on("click","li:not(.optgroup)",function(a){var o=n.find("li");if(a.shiftKey){var s=e(this).index();null==t&&(t=e(this));var r=t.index();if(s>r){var c=s;s=r,r=c}var p=i.find("optgroup, option");e.each(o,function(t){t>=s&&t<=r&&!p[t].disabled?d(e(this),p[t]):l(e(this),p[t])})}else if(t=e(this),"true"!=e(this).attr("data-disabled")){e(this).attr("data-value");var h=i.find("optgroup, option").get(e(this).index());"true"==e(this).attr("data-selected")?l(e(this),h):d(e(this),h)}i.change()})}(e(c),v),function t(a,n,d){a.on("change click",function(){n.find("li").remove();var t=a.find("optgroup, option");o(a,n,t,d),i[d].searchBox.enabled&&s(n,e(`#optionize-searchbox-${d}`))});let l=a[0],r=(t,l)=>{for(let r of t){console.log("MUTATED"),n.find("li").remove();var c=a.find("optgroup, option");o(a,n,c,d),i[d].searchBox.enabled&&s(n,e(`#optionize-searchbox-${d}`))}},c=new MutationObserver(r);c.observe(l,{attributes:!0,childList:!0,subtree:!0}),console.log("STARTED")}(e(c),v,p),function t(a,i){i.on("click",".optgroup",function(){var t=i.find(".optgroup").index(e(this)),n=a.find(`optgroup:eq('${t}')`),o=n.find("option:enabled"),d=n.find("option:selected");o.length==d.length?o.prop("selected",!1):o.prop("selected",!0),a.change()})}(e(c),v),i[p].searchBox.enabled&&(h=v,f=`optionize-searchbox-${p}`,u=p,b=e("<input>",{type:"text",id:f,class:"optionize-search-box",placeholder:i[u].searchBox.placeholder}),b.on("keyup",function(){s(h,b)}),h.before(b))}}),e(this)}}(jQuery);
