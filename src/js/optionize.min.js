!function(e){function t(t,a){var n=a.dataset.afterText||"",i=a.dataset.beforeText||"",d=e("<li>").addClass("optgroup");d.html(i+a.label+n),d.attr("data-hidden","false"),t.append(d)}function a(t,a){var n=a.selected?"selected":"",i=a.disabled?"disabled":"",d=a.hidden||!1,o=e("<li>",{"data-text":a.innerHTML,"data-value":a.value,"data-disabled":a.disabled,"data-selected":a.selected,"data-hidden":d,"data-no-entries-element":a.noEntriesElement||!1}).addClass(n).addClass(i).addClass("option");a.hidden&&o.css("display","none");var s=a.dataset.afterText||"",l=a.dataset.beforeText||"";o.html(l+a.innerHTML+s),t.append(o)}function n(n,i,d,o){var s="disabled"==n.closest("fieldset").attr("disabled");e.each(d,function(e,n){s&&(n.disabled=!0),"OPTGROUP"==n.tagName?t(i,n):a(i,n)}),a(i,{innerHTML:f[o].noEntriesText,disabled:!0,selected:!1,hidden:d.length>0,value:"-",dataset:{},noEntriesElement:!0})}function i(e,t){"OPTGROUP"!=t.tagName&&(e.addClass("selected"),e.attr("data-selected","true"),t.selected=!0)}function d(e,t){"OPTGROUP"!=t.tagName&&(e.removeClass("selected"),e.attr("data-selected","false"),t.selected=!1)}function o(t,a){a.on("click","li:not(.optgroup)",function(n){var o=a.find("li");if(n.shiftKey){var s=e(this).index();null==p&&(p=e(this));var l=p.index();if(s>l){var r=s;s=l,l=r}var c=t.find("optgroup, option");e.each(o,function(t){t>=s&&t<=l&&!c[t].disabled?i(e(this),c[t]):d(e(this),c[t])})}else if(p=e(this),"true"!=e(this).attr("data-disabled")){var h=(e(this).attr("data-value"),t.find("optgroup, option").get(e(this).index()));"true"==e(this).attr("data-selected")?d(e(this),h):i(e(this),h)}t.change()})}function s(t,a,i){t.on("change DOMSubtreeModified click",function(){a.find("li").remove();var d=t.find("optgroup, option");n(t,a,d,i),f[i].searchBox.enabled&&c(t,a,e("#optionize-searchbox-"+i))})}function l(t,a){a.on("click",".optgroup",function(){var n=a.find(".optgroup").index(e(this)),i=t.find("optgroup:eq("+n+")"),d=i.find("option:enabled"),o=i.find("option:selected");d.length==o.length?d.prop("selected",!1):d.prop("selected",!0),t.change()})}function r(t,a,n,i){var d=e("<input>",{type:"text",id:n,class:"optionize-search-box",placeholder:f[i].searchBox.placeholder});d.on("keyup",function(){c(t,a,d)}),a.before(d)}function c(t,a,n){e(n).val().length>0?a.find(".optgroup").attr("data-hidden","true").hide():a.find(".optgroup").attr("data-hidden","false").show();var i=!1;a.find("li").each(function(t,a){regex=new RegExp(e(n).val(),"i"),regex.test(e(a).text())&&"false"==e(a).attr("data-hidden")?(i=!0,e(a).show()):e(a).hide(),i||"true"!=e(a).attr("data-no-entries-element")||e(a).show()})}var p=null,h={searchBox:{enabled:!1,placeholder:"Search"},noEntriesText:"no entries"},f={};e.fn.optionize=function(t){return e(this).each(function(a,i){if("multiple"!==e(i).attr("multiple"))return void console.log("sorry, currently optionize only works on multi select boxes.");var d=e(i).attr("id")||e(i).attr("name");if(d||(d="id-"+e("select").index(e(i)),e(i).attr("id",d)),!(e(".optionize-"+d).length>0)){t&&"object"==typeof t&&(f[d]={},e.extend(!0,f[d],h,t));var c=e(i).find("optgroup, option"),p=e("<ul>").addClass("optionize optionize-"+d);n(e(i),p,c,d),e(i).hide(),e(i).before(p),o(e(i),p),s(e(i),p,d),l(e(i),p),f[d].searchBox.enabled&&r(e(i),p,"optionize-searchbox-"+d,d)}}),e(this)}}(jQuery);
