!function(v){var r=null;function o(t,f,e){var g="disabled"==t.closest("fieldset").attr("disabled");v.each(e,function(t,e){var i,a,d,s,o,n,l,r,c,p,h,u;g&&(e.disabled=!0),"OPTGROUP"==e.tagName?(r=f,p=(c=e).dataset.afterText||"",h=c.dataset.beforeText||"",(u=v("<li>").addClass("optgroup")).html(h+c.label+p),r.append(u)):(i=f,d=(a=e).selected?"selected":"",s=a.disabled?"disabled":"",o=v("<li>",{"data-text":a.innerHTML,"data-value":a.value,"data-disabled":a.disabled,"data-selected":a.selected}).addClass(d).addClass(s).addClass("option"),n=a.dataset.afterText||"",l=a.dataset.beforeText||"",o.html(l+a.innerHTML+n),i.append(o))})}function c(t,e){"OPTGROUP"!=e.tagName&&(t.addClass("selected"),t.attr("data-selected","true"),e.selected=!0)}function p(t,e){"OPTGROUP"!=e.tagName&&(t.removeClass("selected"),t.attr("data-selected","false"),e.selected=!1)}v.fn.optionize=function(){if("multiple"===v(this).attr("multiple")){var n,l,e,i,d,t=this.find("optgroup, option"),a=v(this).attr("id")||v(this).attr("name")||v(this).index(),s=v("<ul>").addClass("optionize optionize-"+a);return o(this,s,t),this.hide(),this.before(s),n=this,(l=s).on("click","li:not(.optgroup)",function(t){var e=l.find("li");if(t.shiftKey){var i=v(this).index();null==r&&(r=v(this));var a=r.index();if(a<i){var d=i;i=a,a=d}var s=n.find("optgroup, option");v.each(e,function(t){i<=t&&t<=a&&!s[t].disabled?c(v(this),s[t]):p(v(this),s[t])})}else if(r=v(this),"true"!=v(this).attr("data-disabled")){v(this).attr("data-value");var o=n.find("optgroup, option").get(v(this).index());"true"==v(this).attr("data-selected")?p(v(this),o):c(v(this),o)}n.change()}),i=s,(e=this).on("change DOMSubtreeModified click",function(){i.find("li").remove();var t=e.find("optgroup, option");o(e,i,t)}),d=this,s.on("click",".optgroup",function(){var t=v(this).index(".optgroup"),e=d.find("optgroup:eq("+t+")"),i=e.find("option:enabled"),a=e.find("option:selected");i.length==a.length?i.prop("selected",!1):i.prop("selected",!0),d.change()}),this}console.log("sorry, currently optionize only works on multi select boxes.")}}(jQuery);