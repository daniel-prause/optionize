!function(e){function t(t,i){var a=i.dataset.afterText||"",o=i.dataset.beforeText||"",n=e("<li>").addClass("optgroup");n.html(o+i.label+a),t.append(n)}function i(t,i){var a=i.selected?"selected":"",o=i.disabled?"disabled":"",n=e("<li>",{"data-text":i.innerHTML,"data-value":i.value,"data-disabled":i.disabled,"data-selected":i.selected}).addClass(a).addClass(o).addClass("option"),d=i.dataset.afterText||"",s=i.dataset.beforeText||"";n.html(s+i.innerHTML+d),t.append(n)}function a(a,o,n){var d="disabled"==a.closest("fieldset").attr("disabled");e.each(n,function(e,a){d&&(a.disabled=!0),"OPTGROUP"==a.tagName?t(o,a):i(o,a)})}function o(e,t){"OPTGROUP"!=t.tagName&&(e.addClass("selected"),e.attr("data-selected","true"),t.selected=!0)}function n(e,t){"OPTGROUP"!=t.tagName&&(e.removeClass("selected"),e.attr("data-selected","false"),t.selected=!1)}function d(t,i){i.on("click","li:not(.optgroup)",function(a){var d=i.find("li");if(a.shiftKey){var s=e(this).index();null==p&&(p=e(this));var l=p.index();if(s>l){var r=s;s=l,l=r}var c=t.find("optgroup, option");e.each(d,function(t){t>=s&&t<=l&&!c[t].disabled?o(e(this),c[t]):n(e(this),c[t])})}else if(p=e(this),"true"!=e(this).attr("data-disabled")){var f=(e(this).attr("data-value"),t.find("optgroup, option").get(e(this).index()));"true"==e(this).attr("data-selected")?n(e(this),f):o(e(this),f)}t.change()})}function s(t,i,o){t.on("change DOMSubtreeModified click",function(){i.find("li").remove();var n=t.find("optgroup, option");a(t,i,n),u[o].searchBox&&c(t,i,e("#optionize-searchbox-"+o))})}function l(t,i){i.on("click",".optgroup",function(){var a=i.find(".optgroup").index(e(this)),o=t.find("optgroup:eq("+a+")"),n=o.find("option:enabled"),d=o.find("option:selected");n.length==d.length?n.prop("selected",!1):n.prop("selected",!0),t.change()})}function r(t,i,a){var o=e("<input>",{type:"text",id:a,class:"optionize-search-box"});o.on("keyup",function(){c(t,i,o)}),i.before(o)}function c(t,i,a){e(a).val().length>0?i.find(".optgroup").hide():i.find(".optgroup").show(),i.find("li").each(function(t,i){regex=new RegExp(e(a).val(),"i"),regex.test(e(i).text())?e(i).show():e(i).hide()})}var p=null,f={searchBox:!1},u={};e.fn.optionize=function(t){return e(this).each(function(i,o){if("multiple"!==e(o).attr("multiple"))return void console.log("sorry, currently optionize only works on multi select boxes.");var n=e(o).attr("id")||e(o).attr("name");if(n||(n="id-"+e("select").index(e(o)),e(o).attr("id",n)),!(e(".optionize-"+n).length>0)){t&&"object"==typeof t&&(u[n]={},e.extend(u[n],f,t));var c=e(o).find("optgroup, option"),p=e("<ul>").addClass("optionize optionize-"+n);a(e(o),p,c),e(o).hide(),e(o).before(p),d(e(o),p),s(e(o),p,n),l(e(o),p),u[n].searchBox&&r(e(o),p,"optionize-searchbox-"+n)}}),e(this)}}(jQuery);
