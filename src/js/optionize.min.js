!function(t){function e(e,a){var i=a.dataset.afterText||"",n=a.dataset.beforeText||"",d=t("<li>").addClass("optgroup");d.html(n+a.label+i),e.append(d)}function a(e,a){var i=a.selected?"selected":"",n=a.disabled?"disabled":"",d=t("<li>",{"data-text":a.innerHTML,"data-value":a.value,"data-disabled":a.disabled,"data-selected":a.selected}).addClass(i).addClass(n).addClass("option"),o=a.dataset.afterText||"",l=a.dataset.beforeText||"";d.html(l+a.innerHTML+o),e.append(d)}function i(i,n,d){var o="disabled"==i.closest("fieldset").attr("disabled");t.each(d,function(t,i){o&&(i.disabled=!0),"OPTGROUP"==i.tagName?e(n,i):a(n,i)})}function n(t,e){"OPTGROUP"!=e.tagName&&(t.addClass("selected"),t.attr("data-selected","true"),e.selected=!0)}function d(t,e){"OPTGROUP"!=e.tagName&&(t.removeClass("selected"),t.attr("data-selected","false"),e.selected=!1)}function o(e,a){a.on("click","li:not(.optgroup)",function(i){var o=a.find("li");if(i.shiftKey){var l=t(this).index();null==r&&(r=t(this));var s=r.index();if(l>s){var c=l;l=s,s=c}var u=e.find("optgroup, option");t.each(o,function(e){e>=l&&e<=s&&!u[e].disabled?n(t(this),u[e]):d(t(this),u[e])})}else if(r=t(this),"true"!=t(this).attr("data-disabled")){var f=(t(this).attr("data-value"),e.find("optgroup, option").get(t(this).index()));"true"==t(this).attr("data-selected")?d(t(this),f):n(t(this),f)}e.change()})}function l(t,e){t.on("change DOMSubtreeModified click",function(){e.find("li").remove();var a=t.find("optgroup, option");i(t,e,a)})}function s(e,a){a.on("click",".optgroup",function(){var i=a.find(".optgroup").index(t(this)),n=e.find("optgroup:eq("+i+")"),d=n.find("option:enabled"),o=n.find("option:selected");d.length==o.length?d.prop("selected",!1):d.prop("selected",!0),e.change()})}var r=null;t.fn.optionize=function(){return t(this).each(function(e,a){if("multiple"!==t(a).attr("multiple"))return void console.log("sorry, currently optionize only works on multi select boxes.");var n=t(a).find("optgroup, option"),d=t(a).attr("id")||t(a).attr("name");d||(d="id-"+t("select").index(t(a)),t(a).attr("id",d));var r=t("<ul>").addClass("optionize optionize-"+d);i(t(a),r,n),t(a).hide(),t(a).before(r),o(t(a),r),l(t(a),r),s(t(a),r)}),t(this)}}(jQuery);
