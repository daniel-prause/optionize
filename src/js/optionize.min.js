!function(e){function t(t,n){var i=n.dataset.afterText||"",a=n.dataset.beforeText||"",o=e("<li>").addClass("optgroup");o.html(a+n.label+i),t.append(o)}function n(t,n){var i=n.selected?"selected":"",a=n.disabled?"disabled":"",o=(n.hidden,e("<li>",{"data-text":n.innerHTML,"data-value":n.value,"data-disabled":n.disabled,"data-selected":n.selected,"data-hidden":n.hidden||!1,"data-no-entries-element":n.noEntriesElement||!1}).addClass(i).addClass(a).addClass("option"));n.hidden&&o.css("display","none");var d=n.dataset.afterText||"",s=n.dataset.beforeText||"";o.html(s+n.innerHTML+d),t.append(o)}function i(i,a,o,d){var s="disabled"==i.closest("fieldset").attr("disabled");e.each(o,function(e,i){s&&(i.disabled=!0),"OPTGROUP"==i.tagName?t(a,i):n(a,i)}),n(a,{innerHTML:u[d].noEntriesText,disabled:!0,selected:!1,hidden:o.length>0,value:"-",dataset:{},noEntriesElement:!0})}function a(e,t){"OPTGROUP"!=t.tagName&&(e.addClass("selected"),e.attr("data-selected","true"),t.selected=!0)}function o(e,t){"OPTGROUP"!=t.tagName&&(e.removeClass("selected"),e.attr("data-selected","false"),t.selected=!1)}function d(t,n){n.on("click","li:not(.optgroup)",function(i){var d=n.find("li");if(i.shiftKey){var s=e(this).index();null==p&&(p=e(this));var l=p.index();if(s>l){var r=s;s=l,l=r}var c=t.find("optgroup, option");e.each(d,function(t){t>=s&&t<=l&&!c[t].disabled?a(e(this),c[t]):o(e(this),c[t])})}else if(p=e(this),"true"!=e(this).attr("data-disabled")){var h=(e(this).attr("data-value"),t.find("optgroup, option").get(e(this).index()));"true"==e(this).attr("data-selected")?o(e(this),h):a(e(this),h)}t.change()})}function s(t,n,a){t.on("change DOMSubtreeModified click",function(){n.find("li").remove();var o=t.find("optgroup, option");i(t,n,o,a),u[a].searchBox.enabled&&c(t,n,e("#optionize-searchbox-"+a))})}function l(t,n){n.on("click",".optgroup",function(){var i=n.find(".optgroup").index(e(this)),a=t.find("optgroup:eq("+i+")"),o=a.find("option:enabled"),d=a.find("option:selected");o.length==d.length?o.prop("selected",!1):o.prop("selected",!0),t.change()})}function r(t,n,i,a){var o=e("<input>",{type:"text",id:i,class:"optionize-search-box",placeholder:u[a].searchBox.placeholder});o.on("keyup",function(){c(t,n,o)}),n.before(o)}function c(t,n,i){e(i).val().length>0?n.find(".optgroup").hide():n.find(".optgroup").show();var a=!1;n.find("li").each(function(t,n){regex=new RegExp(e(i).val(),"i"),regex.test(e(n).text())&&"false"==e(n).attr("data-hidden")?(a=!0,e(n).show()):e(n).hide(),0==a&&"true"==e(n).attr("data-no-entries-element")&&e(n).show()})}var p=null,h={searchBox:{enabled:!1,placeholder:"Search"},noEntriesText:"no entries"},u={};e.fn.optionize=function(t){return e(this).each(function(n,a){if("multiple"!==e(a).attr("multiple"))return void console.log("sorry, currently optionize only works on multi select boxes.");var o=e(a).attr("id")||e(a).attr("name");if(o||(o="id-"+e("select").index(e(a)),e(a).attr("id",o)),!(e(".optionize-"+o).length>0)){t&&"object"==typeof t&&(u[o]={},e.extend(!0,u[o],h,t));var c=e(a).find("optgroup, option"),p=e("<ul>").addClass("optionize optionize-"+o);i(e(a),p,c,o),e(a).hide(),e(a).before(p),d(e(a),p),s(e(a),p,o),l(e(a),p),u[o].searchBox.enabled&&r(e(a),p,"optionize-searchbox-"+o,o)}}),e(this)}}(jQuery);
